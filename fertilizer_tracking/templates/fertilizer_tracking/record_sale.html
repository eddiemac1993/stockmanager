{% extends 'base.html' %}

{% block content %}
<div class="row">
    <div class="col-md-6">
        <h2>Record Daily Sale</h2>
        
        {% if messages %}
            {% for message in messages %}
                <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            {% endfor %}
        {% endif %}
        
        <form method="post">
            {% csrf_token %}
            
            <div class="mb-3">
                <label for="{{ form.date.id_for_label }}" class="form-label">Date:</label>
                {{ form.date }}
                {% if form.date.errors %}
                    <div class="text-danger">{{ form.date.errors }}</div>
                {% endif %}
            </div>
            
            <div class="mb-3">
                <label for="{{ form.depot.id_for_label }}" class="form-label">Depot:</label>
                {{ form.depot }}
                {% if form.depot.errors %}
                    <div class="text-danger">{{ form.depot.errors }}</div>
                {% endif %}
            </div>
            
            <div class="mb-3">
                <label for="{{ form.product.id_for_label }}" class="form-label">Product:</label>
                {{ form.product }}
                {% if form.product.errors %}
                    <div class="text-danger">{{ form.product.errors }}</div>
                {% endif %}
            </div>
            
            <div class="mb-3">
                <label for="{{ form.bags_sold.id_for_label }}" class="form-label">Bags Sold:</label>
                {{ form.bags_sold }}
                {% if form.bags_sold.errors %}
                    <div class="text-danger">{{ form.bags_sold.errors }}</div>
                {% endif %}
            </div>
            
            <button type="submit" class="btn btn-primary">Record Sale</button>
            <a href="{% url 'dashboard' %}" class="btn btn-secondary">Cancel</a>
        </form>
    </div>
    
    <div class="col-md-6">
        <h4>Current Stock Levels</h4>
        <table class="table table-sm table-striped">
            <thead>
                <tr>
                    <th>Depot</th>
                    <th>Product</th>
                    <th>Quantity (MT)</th>
                    <th>Available Bags</th>
                </tr>
            </thead>
            <tbody>
                {% for stock in stocks %}
                <tr>
                    <td>{{ stock.depot.name }}</td>
                    <td>{{ stock.product.name }}</td>
                    <td>{{ stock.quantity|floatformat:2 }}</td>
                    <td><strong class="{% if stock.get_available_bags < 100 %}text-danger{% endif %}">{{ stock.get_available_bags }}</strong> bags</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="4" class="text-center">No stock records found</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
        <div class="alert alert-info">
            <small>
                <strong>Note:</strong> 1 MT = 20 bags. Stock will be automatically reduced when you record a sale.
            </small>
        </div>
    </div>
</div>
{% endblock %}